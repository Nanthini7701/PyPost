{% extends "base.html" %}
{% block title %}{{ post.title }} — My Blog{% endblock %}
{% block content %}
<div class="row">
  <div class="col-lg-8">
    <article>
      <h1>{{ post.title }}</h1>
      <p class="text-muted">By {{ post.author }} • {{ post.created_at|date:"M j, Y" }}</p>
      {% if post.image %}
        <img src="{{ post.image.url }}" class="img-fluid mb-3" alt="{{ post.title }}">
      {% endif %}
      <div>{{ post.content|linebreaks }}</div>
    </article>

    <section class="mt-4">
      <h5>Comments</h5>
      {% for comment in comments %}
        <div class="mb-2">
          <strong>{{ comment.author }}</strong> <span class="text-muted small">{{ comment.created_at|date:"M j, Y H:i" }}</span>
          <div>{{ comment.content }}</div>
        </div>
      {% empty %}
        <p>No comments yet.</p>
      {% endfor %}

      {% if user.is_authenticated %}
      <form method="post" action="{% url 'blog:add_comment' pk=post.pk %}">
        {% csrf_token %}
        <div class="mb-2">
          <textarea name="content" required class="form-control" rows="3"></textarea>
        </div>
        <button class="btn btn-sm btn-primary">Add comment</button>
      </form>
      {% else %}
        <p><a href="{% url 'blog:login' %}">Login</a> to comment.</p>
      {% endif %}
    </section>
  </div>

  <aside class="col-lg-4">
    <div class="card p-3 sticky-top">
      <h6>Post actions</h6>
      {% if user == post.author %}
        <a href="{% url 'blog:post_update' pk=post.pk %}" class="btn btn-sm btn-outline-secondary">Edit</a>
        <a href="{% url 'blog:post_delete' pk=post.pk %}" class="btn btn-sm btn-danger">Delete</a>
      {% endif %}
      <hr>
      <a href="{% url 'blog:post_list' %}" class="btn btn-sm btn-link">Back to posts</a>
    </div>
  </aside>
</div>
{% endblock %}
